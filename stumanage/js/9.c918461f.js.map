{"version":3,"file":"js/9.c918461f.js","mappings":"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","sources":["webpack://StudentManagement/./src/views/personChat.vue","webpack://StudentManagement/./src/util/personalChat.js","webpack://StudentManagement/./src/views/personChat.vue?5faa"],"sourcesContent":["<template>\r\n  <div class=\"chat-box\">\r\n    <header>聊天室 (在线:{{ count }}人)</header>\r\n    <div class=\"msg-box\" ref=\"msg-box\">\r\n      <div\r\n        v-for=\"(i, index) in list\"\r\n        :key=\"index\"\r\n        class=\"msg\"\r\n        :style=\"i.userId == userId ? 'flex-direction:row-reverse' : ''\"\r\n      >\r\n        <div class=\"user-head\">\r\n          <!-- <img :src=\"i.avatar\" height=\"30\" width=\"30\" :title=\"i.username\" /> -->\r\n          <div>{{ i.username }}</div>\r\n        </div>\r\n        <div class=\"user-msg\">\r\n          <span\r\n            :style=\"i.userId == userId ? ' float: right;' : ''\"\r\n            :class=\"i.userId == userId ? 'right' : 'left'\"\r\n            >{{ i.content }}</span\r\n          >\r\n        </div>\r\n      </div>\r\n    </div>\r\n    <div class=\"input-box\">\r\n      <input\r\n        type=\"text\"\r\n        ref=\"sendMsg\"\r\n        v-model=\"contentText\"\r\n        @keyup.enter=\"sendText()\"\r\n      />\r\n      <div\r\n        class=\"btn\"\r\n        :class=\"{ ['btn-active']: contentText }\"\r\n        @click=\"sendText()\"\r\n      >\r\n        发送\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport personalChat from \"@/util/personalChat\";\r\nexport default {\r\n  data() {\r\n    return {\r\n      ws: null,\r\n      count: 0,\r\n      userId: this.$store.state.user.userId, // 当前用户ID\r\n      username: this.$store.state.user.name, // 当前用户昵称\r\n      //   avatar: this.$store.getters.avatar, // 当前用户头像\r\n      list: [], // 聊天记录的数组\r\n      contentText: \"\", // input输入的值\r\n    };\r\n  },\r\n  mounted() {\r\n    this.initWebSocket();\r\n  },\r\n  //   destroyed() {\r\n  //     // 离开页面时关闭websocket连接\r\n  //     // this.ws.onclose(undefined);\r\n  //     this.ws.close();\r\n  //   },\r\n  methods: {\r\n    // 发送聊天信息\r\n    sendText() {\r\n      this.$refs[\"sendMsg\"].focus();\r\n      if (!this.contentText) {\r\n        return;\r\n      }\r\n      if (this.ws.readyState === WebSocket.OPEN) {\r\n        let params = {\r\n          userId: this.userId,\r\n          username: this.username,\r\n          msg: this.contentText,\r\n          count: this.count,\r\n        };\r\n        this.ws.send(JSON.stringify(params)); //调用WebSocket send()发送信息的方法\r\n        this.contentText = \"\";\r\n        setTimeout(() => {\r\n          this.scrollBottm();\r\n        }, 500);\r\n\r\n        this.ws.onmessage = (msg) => {\r\n          let resData = JSON.parse(msg.data);\r\n          // console.log(resData);\r\n          this.count = resData.count;\r\n          this.list = [\r\n            ...this.list,\r\n            {\r\n              userId: resData.userId,\r\n              username: resData.username,\r\n              //   avatar: resData.avatar,\r\n              content: resData.msg,\r\n            },\r\n          ];\r\n          //   console.log(msg);\r\n        };\r\n      } else {\r\n        console.warn(\"WebSocket is not open. Message not sent.\");\r\n      }\r\n    },\r\n    // 进入页面创建websocket连接\r\n    initWebSocket: function () {\r\n      // 判断页面有没有存在websocket连接\r\n      if (window.WebSocket) {\r\n        // var serverHot = window.location.hostname;\r\n        // let sip = \"1\";\r\n        // 填写本地IP地址 此处的 :9101端口号 要与后端配置的一致！\r\n        var url = personalChat.URL + this.userId; // `ws://127.0.0.1/9101/personChat/10086/聊天室`\r\n        this.ws = new WebSocket(url);\r\n        this.ws.onopen = this.open;\r\n        this.ws.onclose = this.close;\r\n        this.ws.onerror = this.error;\r\n        // this.ws.onmessage = (e) => {\r\n        //   //接收服务器返回的数据\r\n        //   let resData = JSON.parse(e.data);\r\n        //   this.count = resData.count;\r\n        //   this.list = [\r\n        //     ...this.list,\r\n        //     {\r\n        //       userId: resData.userId,\r\n        //       username: resData.username,\r\n        //       //   avatar: resData.avatar,\r\n        //       content: resData.msg,\r\n        //     },\r\n        //   ];\r\n        // };\r\n        this.ws.onmessage = this.getMessage;\r\n      }\r\n    },\r\n\r\n    open: function () {\r\n      console.log(\"socket连接成功\");\r\n    },\r\n    error: function () {\r\n      console.log(\"连接错误\");\r\n    },\r\n    getMessage: function (msg) {\r\n      // 接收服务器返回的数据\r\n      let resData = JSON.parse(msg.data);\r\n      this.count = resData.count;\r\n      this.list = [\r\n        ...this.list,\r\n        {\r\n          userId: resData.userId,\r\n          username: resData.username,\r\n          //   avatar: resData.avatar,\r\n          content: resData.msg,\r\n        },\r\n      ];\r\n      //   console.log(JSON.parse(msg.data));\r\n    },\r\n    send: function () {\r\n      this.socket.send(params);\r\n    },\r\n    close: function () {\r\n      console.log(\"socket已经关闭\");\r\n    },\r\n    // 滚动条到底部\r\n    scrollBottm() {\r\n      let el = this.$refs[\"msg-box\"];\r\n      el.scrollTop = el.scrollHeight;\r\n    },\r\n  },\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.chat-box {\r\n  margin: 0 auto;\r\n  background: #fafafa;\r\n  position: absolute;\r\n  height: 85%;\r\n  width: 80%;\r\n  /* max-width: 700px; */\r\n  display: flex;\r\n  top: 111px;\r\n}\r\nheader {\r\n  top: 111px;\r\n  position: fixed;\r\n  width: 80%;\r\n  height: 3rem;\r\n  background: #409eff;\r\n  /* max-width: 700px; */\r\n  display: flex;\r\n  justify-content: center;\r\n  align-items: center;\r\n  font-weight: bold;\r\n  color: white;\r\n  font-size: 1rem;\r\n}\r\n.msg-box {\r\n  position: absolute;\r\n  height: calc(100% - 6.5rem);\r\n  width: 100%;\r\n  margin-top: 3rem;\r\n  overflow-y: scroll;\r\n}\r\n.msg {\r\n  width: 95%;\r\n  min-height: 2.5rem;\r\n  margin: 1rem 0.5rem;\r\n  position: relative;\r\n  display: flex;\r\n  justify-content: flex-start !important;\r\n}\r\n.user-head {\r\n  min-width: 2.5rem;\r\n  width: 5%;\r\n  /* width: 2.5rem; */\r\n  height: 2.5rem;\r\n  border-radius: 50%;\r\n  background: #f1f1f1;\r\n  display: flex;\r\n  justify-content: center;\r\n  align-items: center;\r\n\r\n  /* position: absolute; */\r\n}\r\n.user-msg {\r\n  width: 80%;\r\n  /* position: absolute; */\r\n  word-break: break-all;\r\n  position: relative;\r\n  z-index: 5;\r\n}\r\n.head {\r\n  width: 1.2rem;\r\n  height: 1.2rem;\r\n}\r\nspan {\r\n  display: inline-block;\r\n  padding: 0.5rem 0.7rem;\r\n  border-radius: 0.5rem;\r\n  margin-top: 0.2rem;\r\n  font-size: 0.88rem;\r\n}\r\n.left {\r\n  background: white;\r\n  animation: toLeft 0.5s ease both 1;\r\n}\r\n.right {\r\n  background: #53a8ff;\r\n  color: white;\r\n  animation: toright 0.5s ease both 1;\r\n}\r\n@keyframes toLeft {\r\n  0% {\r\n    opacity: 0;\r\n    transform: translateX(-10px);\r\n  }\r\n  100% {\r\n    opacity: 1;\r\n    transform: translateX(0px);\r\n  }\r\n}\r\n@keyframes toright {\r\n  0% {\r\n    opacity: 0;\r\n    transform: translateX(10px);\r\n  }\r\n  100% {\r\n    opacity: 1;\r\n    transform: translateX(0px);\r\n  }\r\n}\r\n.input-box {\r\n  padding: 0 0.5rem;\r\n  position: absolute;\r\n  bottom: 80px;\r\n  width: 100%;\r\n  height: 3.5rem;\r\n  background: #fafafa;\r\n  box-shadow: 0 0 5px #ccc;\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n}\r\ninput {\r\n  height: 2.3rem;\r\n  display: inline-block;\r\n  width: 100%;\r\n  padding: 0.5rem;\r\n  border: none;\r\n  border-radius: 0.2rem;\r\n  font-size: 0.88rem;\r\n}\r\n.btn {\r\n  height: 2.3rem;\r\n  min-width: 4rem;\r\n  background: #e0e0e0;\r\n  padding: 0.5rem;\r\n  font-size: 0.88rem;\r\n  color: white;\r\n  text-align: center;\r\n  border-radius: 0.2rem;\r\n  margin-left: 0.5rem;\r\n  transition: 0.5s;\r\n}\r\n.btn-active {\r\n  background: #409eff;\r\n}\r\n</style>\r\n","export default {\r\n  URL: \"ws://23.224.232.242:8888/personChat/1/\",\r\n};\r\n","import { render } from \"./personChat.vue?vue&type=template&id=043cd9ce&scoped=true\"\nimport script from \"./personChat.vue?vue&type=script&lang=js\"\nexport * from \"./personChat.vue?vue&type=script&lang=js\"\n\nimport \"./personChat.vue?vue&type=style&index=0&id=043cd9ce&scoped=true&lang=css\"\n\nimport exportComponent from \"../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-043cd9ce\"]])\n\nexport default __exports__"],"names":["class","ref","_createElementBlock","_hoisted_1","_createElementVNode","_toDisplayString","$data","count","_hoisted_2","_Fragment","_renderList","list","i","index","key","style","_normalizeStyle","userId","_hoisted_3","username","_hoisted_4","_normalizeClass","content","_hoisted_5","type","contentText","$event","onKeyup","_cache","_withKeys","$options","sendText","onClick","URL","data","ws","this","$store","state","user","name","mounted","initWebSocket","methods","$refs","focus","readyState","WebSocket","OPEN","params","msg","send","JSON","stringify","setTimeout","scrollBottm","onmessage","resData","parse","console","warn","window","url","personalChat","onopen","open","onclose","close","onerror","error","getMessage","log","socket","el","scrollTop","scrollHeight","__exports__","render"],"sourceRoot":""}