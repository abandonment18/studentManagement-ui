"use strict";(self["webpackChunkStudentManagement"]=self["webpackChunkStudentManagement"]||[]).push([[430],{9430:function(e,s,t){t.r(s),t.d(s,{default:function(){return w}});var n=t(6252),o=t(3577),i=t(9963);const c={class:"chat-box"},r={class:"msg-box",ref:"msg-box"},l={class:"user-head"},u={class:"user-msg"},a={class:"input-box"};function d(e,s,t,d,h,g){return(0,n.wg)(),(0,n.iD)("div",c,[(0,n._)("header",null,"聊天室 (在线:"+(0,o.zw)(h.count)+"人)",1),(0,n._)("div",r,[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(h.list,((e,s)=>((0,n.wg)(),(0,n.iD)("div",{key:s,class:"msg",style:(0,o.j5)(e.userId==h.userId?"flex-direction:row-reverse":"")},[(0,n._)("div",l,[(0,n._)("div",null,(0,o.zw)(h.username),1)]),(0,n._)("div",u,[(0,n._)("span",{style:(0,o.j5)(e.userId==h.userId?" float: right;":""),class:(0,o.C_)(e.userId==h.userId?"right":"left")},(0,o.zw)(e.content),7)])],4)))),128))],512),(0,n._)("div",a,[(0,n.wy)((0,n._)("input",{type:"text",ref:"sendMsg","onUpdate:modelValue":s[0]||(s[0]=e=>h.contentText=e),onKeyup:s[1]||(s[1]=(0,i.D2)((e=>g.sendText()),["enter"]))},null,544),[[i.nr,h.contentText]]),(0,n._)("div",{class:(0,o.C_)(["btn",{["btn-active"]:h.contentText}]),onClick:s[2]||(s[2]=e=>g.sendText())}," 发送 ",2)])])}var h={data(){return{ws:null,count:0,userId:this.$store.state.user.userId,username:this.$store.state.user.name,list:[],contentText:""}},mounted(){this.initWebSocket()},methods:{sendText(){if(this.$refs["sendMsg"].focus(),this.contentText)if(console.log(this.ws),console.log(WebSocket.OPEN),this.ws.readyState===WebSocket.OPEN){let e={userId:this.userId,username:this.username,msg:this.contentText,count:this.count};this.ws.send(JSON.stringify(e)),this.contentText="",setTimeout((()=>{this.scrollBottm()}),500),this.ws.onmessage=e=>{let s=JSON.parse(e.data);console.log(s),this.count=s.count,this.list=[...this.list,{userId:s.userId,username:s.username,content:s.msg}],console.log(e)}}else console.warn("WebSocket is not open. Message not sent.")},initWebSocket:function(){if(window.WebSocket){var e="ws://localhost:8888/personChat/1/"+this.userId;this.ws=new WebSocket(e),this.ws.onopen=this.open,this.ws.onclose=this.close,this.ws.onerror=this.error,this.ws.onmessage=this.getMessage}},open:function(){console.log("socket连接成功")},error:function(){console.log("连接错误")},getMessage:function(e){console.log(e.data)},send:function(){this.socket.send(params)},close:function(){console.log("socket已经关闭")},scrollBottm(){let e=this.$refs["msg-box"];e.scrollTop=e.scrollHeight}}},g=t(3744);const m=(0,g.Z)(h,[["render",d],["__scopeId","data-v-b1125dc8"]]);var w=m}}]);
//# sourceMappingURL=430.dc32aafe.js.map